/*! For license information please see heesch.js.LICENSE.txt */
var heesch;heesch=(()=>{"use strict";var t={2563:(t,i,e)=>{e.r(i),e.d(i,{Heesch:()=>et});var n=function(){function t(t,i,e,n){for(;e<i;)e+=t.size;this.piece=t,this.size=e-i+1,this.ind1=n?i:e,this.forward=n}return t.prototype.point=function(t){return this.piece.point(this.forward?this.ind1+t:this.ind1-t)},t.prototype.revert=function(){return this.forward?new t(this.piece,this.ind1,this.ind1+this.size-1,!1):new t(this.piece,this.ind1-this.size+1,this.ind1,!0)},t.prototype.toString=function(){for(var t=[],i=0;i<this.size;i++)t.push(this.point(i).toString());return t.join("--")},t}(),r=function(){function t(t,i){this.x=t,this.y=i}return t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.addWithCoef=function(i,e){return new t(this.x+e*i.x,this.y+e*i.y)},t.prototype.middle=function(i){return new t((this.x+i.x)/2,(this.y+i.y)/2)},t.prototype.sub=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.mul=function(i){return new t(this.x*i,this.y*i)},t.prototype.div=function(i){return new t(this.x/i,this.y/i)},t.prototype.equals=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)<B},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.vec=function(t){return this.x*t.y-this.y*t.x},Object.defineProperty(t.prototype,"length2",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.length2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return Math.atan2(this.y,this.x)},enumerable:!1,configurable:!0}),t.prototype.dist2=function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},t.prototype.dist=function(t){return Math.sqrt(this.dist2(t))},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t.prototype.update=function(t,i){this.x=t,this.y=i},t}(),o=new r(0,0),s=function(){function t(t,i,e,n,r,o){this.a=t,this.b=i,this.c=e,this.d=n,this.e=r,this.f=o}return t.byPoints=function(i,e,n,o,s){if(i.dist2(e)!=n.dist2(o))return null;s&&(i=new r(i.x,-i.y),e=new r(e.x,-e.y));var a=e.sub(i),h=o.sub(n).angle-a.angle,p=t.rotation(h),u=p.apply(i),l=(p.apply(e),i.sub(u)),c=s?-1:1;return new t(p.a,c*p.b,l.x,p.d,c*p.e,l.y)},t.rotation=function(i){return new t(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0)},t.prototype.apply=function(t,i){void 0===i&&(i=!1);var e=this.a*t.x+this.b*t.y+this.c,n=this.d*t.x+this.e*t.y+this.f;return new r(e,n)},t.prototype.applyToPiece=function(t,i){void 0===i&&(i=!1);for(var e=new Array(t.size),n=0;n<t.size;n++)e[n]=this.apply(t.points[n],i);var r=this.apply(o,i),s=this.apply(t.orientation[0],i),a=this.apply(t.orientation[1],i);return new W(e,[s.sub(r),a.sub(r)])},t.prototype.equals=function(t){return Math.abs(this.a-t.a)<B&&Math.abs(this.b-t.b)<B&&Math.abs(this.c-t.c)<B&&Math.abs(this.d-t.d)<B&&Math.abs(this.e-t.e)<B&&Math.abs(this.f-t.f)<B},t}();function a(t){return new s(-1,0,2*t.x,0,-1,2*t.y)}function h(t,i){return i>0?new s(0,-1,t.x+t.y,1,0,t.y-t.x):new s(0,1,t.x-t.y,-1,0,t.y+t.x)}function p(t,i,e,n){var r=i.sub(t),o=n.sub(e),a=r.angle+o.angle,h=Math.cos(a),p=Math.sin(a),u=new s(h,p,0,p,-h,0),l=e.sub(u.apply(t));return new s(h,p,l.x,p,-h,l.y)}function u(t,i){var e=t.x,n=t.y,r=i.x,o=i.y,a=e+n-o,h=n+r-e,p=e-n+o,u=n-r+e,l=r*h-o*a-(e*h-n*a)+(e*o-r*n),c=o-h,f=h-n,v=n-o,d=a-r,y=e-a,g=r-e,b=r*h-o*a,m=a*n-e*h,x=e*o-r*n;return new s((e*c+r*f+p*v)/l,(e*d+r*y+p*g)/l,(e*b+r*m+p*x)/l,(n*c+o*f+u*v)/l,(n*d+o*y+u*g)/l,(n*b+o*m+u*x)/l)}function l(t){return new s(1,0,t.x,0,1,t.y)}var c=function(){function t(t,i,e,n,r){this.T1=t,this.T2=i,this.pieces=e,this.grid_type=this.evaluate_grid_type().join(""),this.piece_type=n,this.indexes=r.slice()}return t.prototype.evaluate_grid_type=function(){for(var t=this.T1,i=t.x,e=t.y,n=this.T2,r=n.x,o=n.y,s=[],a=0,h=this.pieces[0].points;a<h.length;a++){for(var p=h[a],u=0,l=0,c=this.pieces;l<c.length;l++)for(var v=0,d=c[l].points;v<d.length;v++){var y=d[v];f(i,e,r,o,y.x-p.x,y.y-p.y)&&u++}u>2&&s.push(u)}return s},t}();function f(t,i,e,n,r,o){var s=t*n-e*i,a=(r*n-e*o)/s,h=(t*o-i*r)/s;return Math.abs(a-Math.round(a))<B&&Math.abs(h-Math.round(h))<B}function v(t,i,e,n,r,o){if(r){var s=t.orientation,a=s[0],h=s[1],p=i.orientation,u=p[0],l=p[1];if(!a.equals(u)||!h.equals(l))return!1}function c(t){for(var i=t.point(0),e=0,n=1;n<t.size;n++){var r=t.point(n);(r.y-B>i.y||Math.abs(r.y-i.y)<B&&r.x+B<i.x)&&(i=r,e=n)}return[i,e]}var v=c(t),d=v[0],y=v[1],g=c(i),b=g[0],m=g[1],x=b.sub(d),w=x.x,_=x.y;if(o&&!f(e.x,e.y,n.x,n.y,w,_))return!1;function P(e){for(var n=0;n<t.size;n++){var r=t.point(y+n),o=r.x,s=r.y,a=i.point(m+n*e),h=a.x,p=a.y,u=o+w-h,l=s+_-p;if(Math.abs(u)>=B||Math.abs(l)>=B)return!1}return!0}return P(1)||P(-1)}function d(t,i,e,n){for(var r=0,o=t.pieces;r<o.length;r++)if(v(o[r],i,t.T1,t.T2,e,n))return!0;return!1}function y(t,i,e){for(var n=l(i.T1),r=l(i.T2),o=0,s=i.pieces;o<s.length;o++){var a=s[o];if(!d(t,a,e,!0))return!1;if(!d(t,n.applyToPiece(a),e,!0))return!1;if(!d(t,r.applyToPiece(a),e,!0))return!1}return!0}function g(t,i,e){for(var n=0,r=i.pieces;n<r.length;n++)if(!d(t,r[n],e,!1))return!1;return!0}function b(t,i,e){return y(t,i,e)&&y(i,t,e)}var m=function(){function t(){}return t.isC=function(t){for(var i=t.size,e=t.point(0),n=t.point(i-1),r=(e.x+n.x)/2,o=(e.y+n.y)/2,s=1;2*s<=i;s++){var a=t.point(s),h=t.point(i-s-1),p=(a.x+h.x)/2,u=(a.y+h.y)/2;if(Math.abs(p-r)>=B||Math.abs(u-o)>=B)return!1}return!0},t.isT=function(t,i){var e=t.size;if(e!=i.size)return!1;for(var n=i.point(0).sub(t.point(0)),r=1;r<e;r++)if(!i.point(r).sub(t.point(r)).equals(n))return!1;return!0},t.isC4=function(t,i,e){var n=t.point(0),r=t.size;if(r!=i.size)return!1;for(var o=0;o<r;o++){var s=t.point(o),a=i.point(o),h=s.sub(n),p=a.sub(n),u=h.vec(p),l=h.dot(p);if(Math.abs(l)>=B||Math.abs(h.length2-p.length2)>=B||e*u>0)return!1}return!0},t.isG=function(t,i){var e=t.size,n=i.size,r=t.point(0),o=t.point(e-1),s=i.point(0),a=i.point(n-1);if(r.equals(o)&&s.equals(a))return!0;for(var h=p(r,o,s,a),u=1,l=1;u<e-1&&l<n-1;){for(;u<e-1;){var c=u-1,f=u+1,v=t.point(u),d=t.point(c),y=t.point(f),g=v.sub(d).vec(y.sub(v));if(!(Math.abs(g)<B))break;u++}for(;l<n-1;){var b=l-1,m=l+1,x=i.point(l),w=i.point(b),_=i.point(m),P=x.sub(w).vec(_.sub(x));if(!(Math.abs(P)<B))break;l++}if(!(u<e-1&&l<n-1))return u==e-1&&l==n-1;if(v=t.point(u),x=i.point(l),!h.apply(v).equals(x))return!1;u++,l++}return!0},t.isL=function(t){},t.toString=function(t){for(var i=[],e=0;e<t.size;e++)i.push(t.point(e).toString());return i.join("~")},t.isPerpendicular=function(t,i){return Math.abs(t.a+i.a)<B&&Math.abs(t.b+i.b)<B&&Math.abs(t.d+i.d)<B&&Math.abs(t.e+i.e)<B},t}(),x=function(){function t(t,i,e,n){this.name=t,this.number=i,this.type=e,this.tessellate=n.bind(this)}return Object.defineProperty(t.prototype,"size",{get:function(){return this.type.length},enumerable:!1,configurable:!0}),t}(),w=new x("TTTTTT","Heesch-2",[["."],["."],["."],["T",0],["T",1],["T",2]],(function(t,i){var e=t.point(i[5]).sub(t.point(i[1])),n=t.point(i[3]).sub(t.point(i[1]));return new c(e,n,[t],this,i)})),_=new x("TCCTCC","Heesch-7",[["."],["C"],["C"],["T",0],["C"],["C"]],(function(t,i){var e=t.point(i[4]).sub(t.point(i[0])),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[4]),s=t.point(i[5]),h=a(o.middle(s)),p=h.apply(r,!0).sub(n),u=[t,h.applyToPiece(t,!0)];return new c(e,p,u,this,i)})),P=new x("CC4C4C4C4","Heesch-16",[["C"],["."],["C4",1],["."],["C4",3]],(function(t,i){for(var e=t.point(i[2]),n=h(e,t.sign),r=t.point(i[0]),o=t.point(i[1]),s=r.middle(o).sub(e).mul(2),a=t.point(i[4]),p=n.apply(n.apply(a,!0),!0).sub(a),u=[t],l=t,f=0;f<3;f++)l=n.applyToPiece(l,!0),u.push(l);return new c(s,p,u,this,i)})),T=new x("TG1G1TG2G2","Heesch-18",[["."],["-"],["G",1],["T",0],["-"],["G",4]],(function(t,i){var e=t.point(i[0]),n=t.point(i[4]),r=n.sub(e),o=t.point(i[5]),s=p(n,o,o,e),a=t.point(i[3]),h=s.apply(a,!0),u=t.point(i[2]).sub(h),l=[t,s.applyToPiece(t,!0)];return new c(r,u,l,this,i)})),M=new x("TG1G2TG2G1","Heesch-20",[["."],["-"],["."],["T",0],["G",2],["G",1]],(function(t,i){var e=t.point(i[0]),n=t.point(i[4]),r=n.sub(e),o=t.point(i[1]),s=t.point(i[2]),a=t.point(i[5]);if(Math.abs(o.sub(s).vec(a.sub(e)))<B&&Math.abs(n.sub(a).vec(a.sub(e)))>=B)return null;var h=p(o,s,a,e),u=h.apply(n,!0).sub(s),l=[t,h.applyToPiece(t,!0)];return new c(r,u,l,this,i)})),C=new x("TCCTGG","Heesch-24",[["."],["C"],["C"],["T",0],["."],["G",4]],(function(t,i){var e=t.point(i[0]),n=t.point(i[2]),r=t.point(i[3]),o=t.point(i[4]),s=t.point(i[5]),h=a(n.middle(r)),u=p(o,s,s,e),l=h.applyToPiece(t,!0),f=o.sub(e),v=h.apply(e,!0),d=h.apply(s,!0),y=u.apply(d,!0).sub(v),g=[t,l,u.applyToPiece(t,!0),u.applyToPiece(l,!0)];return new c(f,y,g,this,i)})),L=new x("CG1CG2G1G2","Heesch-28",[["."],["-"],["G",0],["C"],["G",1],["C"]],(function(t,i){var e=t.point(i[3]),n=t.point(i[4]),r=t.point(i[5]),o=t.point(i[0]),s=t.point(i[1]),h=t.point(i[2]),u=a(e.middle(n)),l=p(s,h,n,r);if(!o.equals(s)){var f=p(h,e,o,s);if(!m.isPerpendicular(l,f))return null}var v=r.sub(u.apply(o,!0)),d=h.sub(l.apply(r,!0)),y=l.applyToPiece(t,!0),g=[t,u.applyToPiece(t,!0),y,u.applyToPiece(y,!0)];return new c(v,d,g,this,i)})),z=new x("LTGGT","IH-22",[["L"],["."],["-"],["G",2],["T",1]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]),s=p(r,o,o,t.point(i[4])),a=s.apply(n),h=e.sub(n),u=a.sub(n);return new c(h,u,[t,s.applyToPiece(t)],this,i)})),E=new x("LTCCT","IH-24",[["L"],["."],["C"],["C"],["T",1]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]),s=t.point(i[4]),h=a(o.middle(s)),p=h.applyToPiece(t),l=u(e,n),f=[t,p,l.applyToPiece(t),l.applyToPiece(p)],v=s.sub(r),d=h.apply(e),y=l.apply(d).sub(d);return new c(v,y,f,this,i)})),S=new x("LLC4C4","IH-56",[["L"],["L"],["."],["C4",2]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]);if("square"!==R(e,n,r,o))return null;var s=h(o,t.sign),a=u(e,n),p=s.applyToPiece(t),l=u(n,r),f=l.applyToPiece(t),v=l.applyToPiece(p),d=[t,p,f,v,a.applyToPiece(t),a.applyToPiece(p),a.applyToPiece(f),a.applyToPiece(v)],y=o.sub(e).mul(4),g=r.sub(e).mul(2);return new c(y,g,d,this,i)})),k=new x("LLLL","IH-48",[["L"],["L"],["L"],["L"]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]),s=R(e,n,r,o);if("square"!==s&&"rectangle"!==s)return null;var a=u(r,o),h=u(e,o),p=a.applyToPiece(t),l=h.applyToPiece(t),f=a.applyToPiece(l),v=o.sub(e).mul(2),d=n.sub(e).mul(2);return new c(v,d,[t,p,l,f],this,i)})),G=new x("LTLT","IH-42",[["L"],["."],["L"],["T",1]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]),s=[t,u(r,o).applyToPiece(t)],a=n.sub(e),h=r.sub(n).mul(2);return new c(a,h,s,this,i)})),q=new x("LCLC","IH-49",[["L"],["C"],["L"],["C"]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]),s=n.sub(e),h=r.sub(o);if(Math.abs(s.vec(h))>=B)return null;var p=u(r,o),l=a(e.middle(o)),f=p.applyToPiece(t),v=l.applyToPiece(t),d=p.applyToPiece(v),y=p.apply(n),g=l.apply(r);return new c(n.sub(y),n.sub(g),[t,f,v,d],this,i)})),H=new x("LGLG","IH-45",[["L"],["."],["L"],["G",1]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]),s=n.sub(e),a=r.sub(o);if(Math.abs(s.vec(a))>=B)return null;var h=r.sub(n),p=o.sub(e);if(Math.abs(h.vec(p))<B)return null;var l=u(r,o),f=l.applyToPiece(t),v=o.sub(n),d=l.apply(n).sub(n);return new c(v,d,[t,f],this,i)})),j=new x("LLLC","IH-54",[["L"],["L"],["L"],["C"]],(function(t,i){var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=t.point(i[3]),s=n.sub(e),h=r.sub(n);if(Math.abs(s.dot(h))>B)return null;var p=r.sub(o);if(Math.abs(h.dot(p))>B)return null;var l=a(e.middle(o)),f=u(e,n),v=l.applyToPiece(t),d=f.applyToPiece(t),y=f.applyToPiece(v);return new c(h.mul(2),s.add(p),[t,v,d,y],this,i)})),I=new x("LC4C4","IH-81",[["L"],["."],["C4",1]],(function(t,i){for(var e=t.point(i[0]),n=t.point(i[1]),r=t.point(i[2]),o=h(r,t.sign),s=o.apply(n),a=o.applyToPiece(t),p=u(e,n),l=u(n,s),f=[t,a],v=f.slice(),d=0,y=f;d<y.length;d++){var g=y[d];v.push(p.applyToPiece(g))}for(var b=v.slice(),m=0,x=v;m<x.length;m++)g=x[m],b.push(l.applyToPiece(g));return new c(r.sub(e).mul(2),r.sub(n).mul(2),b,this,i)})),O=[w,_,P,T,M,C,L,z,E,S,k,G,q,H,j,I];function R(t,i,e,n){var r=i.sub(t),o=e.sub(n);if(!r.equals(o))return"no";var s=e.sub(i),a=n.sub(t);return s.equals(a)?Math.abs(r.dot(s))>B?"parallelogram":Math.abs(r.length2-o.length2)>B?"rectangle":"square":"no"}var B=1e-10,A=[new r(1,0),new r(0,1)],W=function(){function t(t,i){void 0===i&&(i=A),this.points=[],this.invariants_matrix=null,this.points=t,this.orientation=i;var e=i[0],n=i[1],r=e.dot(n);Math.abs(r)>B&&console.log("ERROR",e.toString(),n.toString()),this.sign=this.evaluate_sign()}return Object.defineProperty(t.prototype,"size",{get:function(){return this.points.length},enumerable:!1,configurable:!0}),t.prototype.point=function(t){var i=this.size,e=t%i;return e<0&&(e+=i),this.points[e]},t.prototype.part=function(t,i,e){return void 0===e&&(e=!0),new n(this,t,i,e)},t.prototype.fulfill=function(){var i=[];function e(t,e){if(!t.equals(e))for(var n=e.x-t.x,o=e.y-t.y,s=function(t,i){for(t<0&&(t=-t),i<0&&(i=-i);0!=i;){var e=i;i=t%i,t=e}return t}(n,o),a=n/s,h=o/s,p=0;p<s;p++){var u=new r(t.x+p*a,t.y+p*h);i.push(u)}}for(var n=1;n<this.size;n++)e(this.point(n-1),this.point(n));return e(this.point(this.size-1),this.point(0)),new t(i)},t.prototype.toString=function(){return this.points.join("~")},t.prototype.boundingBox=function(){var t=this.points.map((function(t){return t.x})),i=this.points.map((function(t){return t.y}));return{xmin:Math.min.apply(Math,t),xmax:Math.max.apply(Math,t),ymin:Math.min.apply(Math,i),ymax:Math.max.apply(Math,i)}},t.prototype.searchForType=function(t){this.invariants_matrix||this.evaluate_invariants();var i=this,e=this.size,n=0,r=0;function o(s,a,h,p){n++;var u=s.size;if(h==u)return r++,void t(s,a);var l,c,f,v=s.type[h],d=v[0],y=v[1],g=a[0]+e,b=a[y],x=a[y+1];if(l=a[h],c=g,"-"!=d&&"L"!=d||(l+=1),"."!=d&&"-"!=d&&"C"!=d&&"L"!=d){f=i.invariants_matrix[b%e][x%e];var w=x-b,_=a[h]+w;(_<l||_>c)&&(_=Math.floor((l+c)/2));for(var P=!0,T=f[1],M=!1;l<=c;){P?P=!1:_=Math.floor((l+c)/2);var C=i.invariants_matrix[a[h]%e][_%e][1];if(Math.abs(C-T)<B){l=_,c=_,M=!0;break}C<T?l=_+1:c=_-1}if(!M)return}else f=null;c=Math.min(g,c),h==u-1&&(l=Math.max(g,l)),a[h]+e==c&&c--;for(var L=l;L<=c;L++){var z=p,E=i.invariants_matrix[a[h]%e][L%e];if("."!=d&&"-"!=d){var S=i.part(a[h],L);if("C"==d){if(0!=E[0]||!m.isC(S))continue}else if("L"==d){if(!E[2])return}else{if(f[0]!==E[0]||Math.abs(f[1]-E[1])>=B||f[2]!==E[2])continue;var k=i.part(b,x);switch(d){case"G":if(!m.isG(k,S))continue;break;case"T":if(!m.isT(k.revert(),S))continue;break;case"C4":if(!m.isC4(k.revert(),S,i.sign))continue}z=p-E[1]}}else z=p+E[1];if(h<u-1){a[h+1]=L;var G=i.invariants_matrix[a[0]%e][L%e][1];if(z-B>i.full_length-G)return}o(s,a,h+1,z)}}console.time("search for type");for(var s=0,a=0,h=0,p=O;h<p.length;h++){var u=p[h];console.time("search "+u.name);for(var l=new Array(u.size),c=0;c<e;c++)l[0]=c,o(u,l,0,0);console.timeEnd("search "+u.name),console.log("count",u.name,u.number,r-s+" of "+(n-a),r+" of "+n),a=n,s=r}console.timeEnd("search for type")},t.prototype.center=function(){for(var t=new r(0,0),i=0,e=this.points;i<e.length;i++){var n=e[i];t.update(t.x+n.x,t.y+n.y)}return t.update(t.x/this.size,t.y/this.size),t},t.prototype.point_is_inside_edge=function(t){var i=this.point(t-1),e=this.point(t),n=this.point(t+1);return Math.abs(i.sub(e).vec(e.sub(n)))<B},Object.defineProperty(t.prototype,"size_without_inner_points",{get:function(){for(var t=0,i=0;i<this.size;i++)this.point_is_inside_edge(i)||t++;return t},enumerable:!1,configurable:!0}),t.prototype.evaluate_invariants=function(){var t=this.size;this.invariants_matrix=new Array(t);for(var i=0;i<t;i++){var e=0,n=0,r=!0;this.invariants_matrix[i]=new Array(t),this.invariants_matrix[i][i]=[Math.abs(e),n,r];for(var o=i+1;o<i+t;o++){var s=o%t,a=this.point(o-1),h=this.point(o).sub(a);if(n+=h.length,o>i+1){var p=this.point(o-2),u=a.sub(p);e+=u.vec(h),r=r&&Math.abs(u.vec(h))<B}this.invariants_matrix[i][s]=[Math.abs(e),n,r]}}this.full_length=this.invariants_matrix[0][t-1][1]+this.points[t-1].dist(this.points[0])},t.prototype.evaluate_sign=function(){for(var t=0,i=0;i<this.points.length;i++){var e=0==i?this.points.length-1:i-1;t+=this.points[e].vec(this.points[i])}return Math.abs(t)<B?0:t>0?1:-1},t.prototype.find_symmetry=function(){var t=this.points.length,i=[],e=[];function n(t){for(var e=0,n=i;e<n.length;e++)if(n[e].equals(t))return!0;return!1}for(var o=0;o<t;o++)for(var s=this.points[o],h=s.x,p=s.y,l=o+1;l<t;l++){var c=this.points[l],f=c.x,v=c.y;if(!(Math.abs(h-f)+Math.abs(p-v)<B)){for(var d=(h+f)/2,y=(p+v)/2,g=d+(p-v),b=y+(f-h),m=new r(d,y),x=new r(g,b),w=u(m,x),_=a(m),P=w.applyToPiece(this),T=_.applyToPiece(this),M=!0,C=0;C<t;C++)if(!this.point(o+C).equals(P.point(l-C))){M=!1;break}var L=!0;for(C=0;C<t;C++)if(!this.point(o+C).equals(T.point(l+C))){L=!1;break}M&&!n(w)&&(i.push(w),e.push(["sym",m,x])),L&&!n(_)&&(i.push(_),e.push(["rot",m]))}}return e},t}(),V=function(){function t(t,i,e,n,r,o,s){this.tesselation=i,this.x0=e,this.y0=n,this.width=r,this.height=o,this.one=s,this.dog=t}return t.prototype.draw=function(t,i,e){var n=this;t.save(),t.fillStyle=e,0==this.tesselation.T1.x&&0==this.tesselation.T1.y||t.fillRect(0,0,this.width,this.height),t.lineWidth=2,t.strokeStyle=i,t.lineJoin="round";for(var r=function(t){var i=t.x,e=t.y;return[n.x0+n.one*i,n.y0-n.one*e]},o=[this.one*this.tesselation.T1.x,-this.one*this.tesselation.T1.y],s=[this.one*this.tesselation.T2.x,-this.one*this.tesselation.T2.y],a=function(i){for(var e=i.size,a=new Array(e),p=0;p<e;p++){var u=i.points[p];a[p]=r(u)}var l=function(r){for(var h=new Array(e),p=1e100,u=-1e100,l=0;l<e;l++){var c=a[l][0]+r*o[0],f=a[l][1]+r*o[1];h[l]=[c,f];var v=X(0,c,s[0],n.width),d=v[0],y=v[1],g=X(0,f,s[1],n.height),b=g[0],m=g[1],x=Math.max(d,b),w=Math.min(y,m);x<p&&(p=x),w>u&&(u=w)}if(u-p>100)return!1;for(var _=p;_<=u;_++)Y(t,a,o[0]*r+s[0]*_,o[1]*r+s[1]*_,i.orientation,n.dog,!1);return p<=u};if(0==o[0]&&0==s[0])t.lineWidth=4,Y(t,a,0,0,i.orientation,h.dog,!0);else{for(var c=0;c<100&&l(c++););for(c=-1;c>-100&&l(c--););}},h=this,p=0,u=this.tesselation.pieces;p<u.length;p++)a(u[p]);t.restore()},t}();function X(t,i,e,n){if(Math.abs(e)<B)return[-1e6,1e6];var r=(t-i)/e,o=(n-i)/e;return r<o?[Math.ceil(r-B),Math.floor(o+B)]:[Math.ceil(o-B),Math.floor(r+B)]}function Y(t,i,e,n,r,o,s){t.save(),t.beginPath();var a=i[0],h=a[0]+e,p=a[1]+n,u=h,l=p;t.moveTo(h,p);for(var c=i.length,f=1;f<c;f++){var v=i[f],d=v[0]+e,y=v[1]+n;u+=d,l+=y,t.lineTo(d,y)}if(t.closePath(),t.clip(),s&&t.fill(),t.stroke(),o){var g=u/c,b=l/c;t.translate(g,b);var m=Math.atan2(r[0].y,r[0].x);t.rotate(-m),r[0].vec(r[1])<0&&t.scale(1,-1),t.drawImage(o,-o.width/2,-o.height/2)}t.restore()}var D=function(){for(var t=0,i=0,e=arguments.length;i<e;i++)t+=arguments[i].length;var n=Array(t),r=0;for(i=0;i<e;i++)for(var o=arguments[i],s=0,a=o.length;s<a;s++,r++)n[r]=o[s];return n},F=20,J=400,K=400,N="#3366cc";function Q(t,i){function e(t){var i=t[0],e=i.x,n=i.y,r=t[1],o=r.x,s=r.y;return[n-s,o-e,e*s-o*n]}function n(t,i){var e=t[0],n=t[1],r=t[2];return e*i.x+n*i.y+r}var r=e(t),o=n(r,i[0])*n(r,i[1]);if(o>B)return!1;var s=e(i),a=n(s,t[0])*n(s,t[1]);if(a>B)return!1;if(o<-B||a<-B)return!0;var h=[t[0].x,t[1].x,i[0].x,i[1].x];return!(Math.max(h[0],h[1])+B<Math.min(h[2],h[3])||Math.min(h[0],h[1])-B>Math.max(h[2],h[3])||(h=[t[0].y,t[1].y,i[0].y,i[1].y],Math.max(h[0],h[1])+B<Math.min(h[2],h[3])||Math.min(h[0],h[1])-B>Math.max(h[2],h[3])))}function U(t,i,e){var n=t.sub(i),r=e.sub(i),o=n.vec(r);return Math.abs(o)>B||n.dot(r)<0}var Z=function(){function t(t){var i=this;this.movingPoint=-1,this.highlightedPoint=-1,this.highlightedEdge=-1,this.errorEdges=new Set,this.info_points=[],this.info_lines=[],this._pieceChangeListener=void 0,this.canvas=t,this.ctx=t.getContext("2d"),t.width=J,t.height=K,this.X0=200,this.Y0=200,t.addEventListener("mousedown",(function(t){var e=i.getCursorPosition(t),n=i.findPoint(e);if(-1!=n)return i.movingPoint=n,i.movingClick=e,void(i.movingPointClickPosition=i.point2pixel(i.points[n]));i.movingPoint=-1;var r=i.findEdge(e);if(-1!=r){var o=i.pixel2point(e);o.update(Math.round(o.x),Math.round(o.y)),i.points.splice(r,0,o),i.movingPoint=r,i.movingClick=e,i.movingPointClickPosition=i.point2pixel(o),i.redraw()}})),t.addEventListener("mousemove",(function(t){var e=i.getCursorPosition(t),n=i.highlight(e);if(-1!=i.movingPoint){var r=e[0]-i.movingClick[0]+i.movingPointClickPosition[0],o=e[1]-i.movingClick[1]+i.movingPointClickPosition[1];r<0&&(r=0),r>i.canvas.width&&(r=i.canvas.width-1),o<0&&(o=0),o>i.canvas.width&&(o=i.canvas.height-1);var s=i.points[i.movingPoint],a=s.x,h=s.y;if(i.pixel2point([r,o],s),s.update(Math.round(s.x),Math.round(s.y)),a!=s.x||h!=s.y){var p=0==i.movingPoint?i.points.length-1:i.movingPoint-1,u=i.movingPoint==i.points.length-1?0:i.movingPoint+1,l=s.equals(i.points[p])||s.equals(i.points[u]);if(i.updateErrorEdges(),i.clear_info(),i.redraw(),l){i.ctx.save(),i.ctx.font="18px sans-serif",i.ctx.textAlign="center",i.ctx.textBaseline="bottom";var c=i.point2pixel(s),f=c[0],v=c[1],d="Удалить вершину",y=i.ctx.measureText(d);i.ctx.fillStyle="rgba(255, 255, 255, 0.8)",i.ctx.fillRect(f-y.actualBoundingBoxLeft-2,v-8-2-y.actualBoundingBoxAscent-2,y.width+4,y.actualBoundingBoxAscent+y.actualBoundingBoxDescent+4),i.ctx.fillStyle="black",i.ctx.fillText(d,f,v-8-2),i.ctx.restore()}i.firePieceChange()}}else n&&i.redraw()})),document.addEventListener("mouseup",(function(t){if(-1!=i.movingPoint){var e=i.points[i.movingPoint];e.update(Math.round(e.x),Math.round(e.y));var n=0==i.movingPoint?i.points.length-1:i.movingPoint-1,r=i.movingPoint==i.points.length-1?0:i.movingPoint+1;(e.equals(i.points[n])||e.equals(i.points[r]))&&i.points.length>3&&i.points.splice(i.movingPoint,1),i.movingPoint=-1,i.highlight(i.getCursorPosition(t)),i.updateErrorEdges(),i.clear_info(),i.redraw(),i.firePieceChange()}}))}return t.prototype.updatePoints=function(t){this.points=t,this.movingPoint=-1,this.highlightedPoint=-1,this.highlightedEdge=-1,this.updateErrorEdges(),this.clear_info(),this.redraw(),this.firePieceChange()},t.prototype.redraw=function(){this.drawGrid(),this.drawEdges(),this.drawVertices(),this.drawInfo()},t.prototype.drawGrid=function(){var t=this.pixel2point([0,0]),i=t.x,e=t.y,n=this.pixel2point([J,K]),r=n.x,o=n.y;i=Math.floor(i),o=Math.floor(o),r=Math.ceil(r),e=Math.ceil(e);var s=this.ctx;s.save(),s.fillStyle="#afeccc",s.fillRect(0,0,J,K),s.beginPath();for(var a=i;a<=r;a++){var h=this.X0+a*F;s.moveTo(h,0),s.lineTo(h,K)}for(var p=o;p<=e;p++){var u=this.Y0-p*F;s.moveTo(0,u),s.lineTo(J,u)}s.strokeStyle="#91b8d7",s.lineWidth=.75,s.stroke(),s.restore()},t.prototype.drawEdges=function(){var t=this,i=this.ctx;i.save();var e=function(e,n,r,o){i.save(),o&&i.setLineDash([10,F/3]),i.strokeStyle=n,i.lineWidth=r;var a=e-1;a<0&&(a=s-1);var h=t.point2pixel(t.points[e]),p=h[0],u=h[1],l=t.point2pixel(t.points[a]),c=l[0],f=l[1];i.beginPath(),i.moveTo(p,u),i.lineTo(c,f),i.stroke(),i.restore()},n=this.point2pixel(this.points[0]),r=n[0],o=n[1];i.beginPath(),i.moveTo(r,o);for(var s=this.points.length,a=1;a<s;a++){var h=this.point2pixel(this.points[a]),p=h[0],u=h[1];i.lineTo(p,u)}for(i.closePath(),i.fillStyle="rgba(163, 179, 206, 0.5)",i.fill(),a=0;a<s;a++)this.errorEdges.has(a)?e(a,"#e6332a",2,!0):e(a,"#3366cc",2,!1);this.highlightedEdge>=0&&e(this.highlightedEdge,"#000000",2,!1),i.restore()},t.prototype.drawVertices=function(){var t=this.ctx;t.save(),t.lineWidth=1.5;for(var i=0;i<this.points.length;i++){var e=this.points[i],n=this.point2pixel(e),r=n[0],o=n[1],s=0==i?this.points[this.points.length-1]:this.points[i-1],a=i==this.points.length-1?this.points[0]:this.points[i+1],h=Math.abs(s.sub(e).vec(a.sub(e)))<B,p=!0,u=!0;i==this.highlightedPoint?(t.fillStyle="#ffde00",t.strokeStyle="#000000"):h?(p=!1,t.strokeStyle=N):(u=!1,t.fillStyle=N),t.beginPath(),t.arc(r,o,8,0,2*Math.PI),p&&t.fill(),u&&t.stroke()}t.restore()},t.prototype.drawInfo=function(){var t,i=this,e=function(t){var e=t.x,n=t.y;return[i.X0+F*e,i.Y0-F*n]};this.ctx.save(),this.ctx.strokeStyle="white",this.ctx.lineWidth=2,this.ctx.globalAlpha=1,this.ctx.beginPath();for(var n=0,r=this.info_points;n<r.length;n++){var o=r[n];(t=this.ctx).arc.apply(t,D(e(o),[4,0,2*Math.PI]))}this.ctx.stroke(),this.ctx.setLineDash([4,4]),this.ctx.beginPath();for(var s=0,a=this.info_lines;s<a.length;s++){var h=a[s],p=h[0],u=h[1],l=e(p),c=l[0],f=l[1],v=e(u),d=v[0],y=v[1],g=c-100*(d-c),b=f-100*(y-f),m=c+100*(d-c),x=f+2*(y-f);this.ctx.moveTo(g,b),this.ctx.lineTo(m,x)}this.ctx.stroke(),this.ctx.restore()},t.prototype.getCursorPosition=function(t){var i=this.canvas.getBoundingClientRect();return[t.clientX-i.left,t.clientY-i.top]},t.prototype.pixel2point=function(t,i){void 0===i&&(i=null);var e=t[0],n=t[1],o=(e-this.X0)/F,s=-(n-this.Y0)/F;return null==i?new r(o,s):(i.update(o,s),i)},t.prototype.point2pixel=function(t){return[this.X0+t.x*F,this.Y0-t.y*F]},Object.defineProperty(t.prototype,"piece",{get:function(){return this.errorEdges.size>0?null:new W(this.points)},set:function(t){t.size,this.points=t.points.slice(),this.updateErrorEdges(),this.redraw()},enumerable:!1,configurable:!0}),t.prototype.highlight=function(t){var i=this.highlightedPoint,e=this.highlightedEdge,n=this.movingPoint;return-1==n&&(n=this.findPoint(t)),n>=0?(this.highlightedPoint=n,this.highlightedEdge=-1):(this.highlightedPoint=-1,this.highlightedEdge=this.findEdge(t)),e!=this.highlightedEdge||i!=this.highlightedPoint},t.prototype.findPoint=function(t){for(var i=0;i<this.points.length;i++){var e=this.points[i],n=this.point2pixel(e);if(Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1])<13.333333333333334)return i}return-1},t.prototype.findEdge=function(t){for(var i=0;i<this.points.length;i++){var e=0==i?this.points[this.points.length-1]:this.points[i-1],n=this.points[i],r=t[0],o=t[1],s=this.point2pixel(e),a=s[0],h=s[1],p=this.point2pixel(n),u=p[0],l=p[1];if(a!=u||h!=l){var c=l-h,f=a-u,v=c*r+f*o+(u*h-a*l);if(!(v*v>177.7777777777778*(c*c+f*f))){var d=a-u,y=h-l,g=-d*a-y*h,b=-d*u-y*l;if(!((a*d+h*y+b)*(r*d+o*y+b)<=0||(u*d+l*y+g)*(r*d+o*y+g)<=0))return i}}}return-1},t.prototype.updateErrorEdges=function(){this.errorEdges.clear();for(var t=this.points.length,i=0;i<t;i++){var e=0==i?t-1:i-1,n=i,r=this.points[e],o=this.points[n];if(r.equals(o))this.errorEdges.add(n);else for(var s=i+1;s<i+t;s++){var a=(s-1)%t,h=s%t,p=this.points[a],u=this.points[h];p.equals(u)||(s==i+1&&!U(r,o,u)||s==i+t-1&&!U(p,r,o)||s>i+1&&s<i+t-1&&Q([r,o],[p,u]))&&(this.errorEdges.add(n),this.errorEdges.add(h))}}},t.prototype.firePieceChange=function(){if(this._pieceChangeListener){if(this.errorEdges.size>0)return void this._pieceChangeListener(null);for(var t=[],i=0,e=this.points;i<e.length;i++){var n=e[i];t.push(new r(n.x,n.y))}this._pieceChangeListener(new W(t))}},Object.defineProperty(t.prototype,"pieceChangeListener",{set:function(t){this._pieceChangeListener=t},enumerable:!1,configurable:!0}),t.prototype.clear_info=function(){this.info_points=[],this.info_lines=[]},t.prototype.draw_info_point=function(t){this.info_points.push(t)},t.prototype.draw_info_line=function(t,i){this.info_lines.push([t,i])},t}(),$="#A3B3CE",tt="#6C8FC1",it=new r(0,0),et=function(){function t(t){this.tessellations=[],this.need_take_care_of_orientation=!1,this.draw_orientation=!0,this.has_error=!1,this.has_symmetries=!1,this.maximize_symmetries=!1,this.dog_number=1,this.settings=t,this.need_take_care_of_orientation=+t.level>0,this.draw_orientation=!0,this.maximize_symmetries=0==+t.level,this.dog_number=+t.level%2==0?1:2}return t.prototype.id=function(){return"heesch"+this.settings.level},t.prototype.initialize=function(t,i,e){var n=this;this.kioapi=i,this.editor_canvas=document.createElement("canvas"),this.editor_canvas.classList.add("piece"),this.editor_canvas.width=400,this.editor_canvas.height=400,this.tesselation_canvas=document.createElement("canvas"),this.tesselation_canvas.height=500,this.tesselation_canvas.classList.add("tesselation");var o=function(){n.tesselation_canvas.width=t.clientWidth,n.updateTessellationView()};window.addEventListener("resize",nt(o)),this.tessellation_ctx=this.tesselation_canvas.getContext("2d"),this.tessellations=[],this.tesselationSelect=document.createElement("select"),this.tesselationSelect.size=20,this.tesselationSelect.addEventListener("input",(function(t){return n.updateTessellationView()})),t.classList.add("heesch-task-container"),t.appendChild(this.tesselation_canvas),t.appendChild(this.editor_canvas),t.append(this.tesselationSelect);var s=new W([new r(4,3),new r(1,4),new r(0,2),new r(-2,1),new r(-2,-1),new r(0,-2),new r(0,-4),new r(1,-2),new r(4,-3),new r(5,0),new r(6,0),new r(5,3)]);this.editor=new Z(this.editor_canvas),this.editor.piece=s,this.updateTessellationPiece(s),this.editor.pieceChangeListener=nt((function(t){return n.updateTessellationPiece(t)})),o()},t.preloadManifest=function(){return[{id:"dog",src:"heesch-resources/squid.png"},{id:"dog2",src:"heesch-resources/jellyfish.png"},{id:"wave",src:"heesch-resources/wave.png"}]},t.prototype.parameters=function(){var t={name:"ok",title:"Есть узор",ordering:"maximize",view:function(t){return 1==t?"да":"нет"}},i={name:"g",title:"Видов узоров",ordering:"maximize"},e={name:"v",title:"Вершин",ordering:"maximize"},n={name:"s",title:"Симметрии",ordering:this.maximize_symmetries?"maximize":"minimize",view:function(t){return 1==t?"есть":"нет"}};return this.maximize_symmetries?[t,i,e,n]:[t,n,i,e]},t.prototype.loadSolution=function(t){if(t&&"p"in t){for(var i=t.p,e=i.length,n=[],o=0;o<e;o+=2)n.push(new r(i[o],i[o+1]));this.editor.updatePoints(n),this.update_symmetries(this.editor.piece)}},t.prototype.updateTessellationView=function(){var t=this.tesselation_canvas.width,i=this.tesselation_canvas.height,e=(t+this.tesselationSelect.getBoundingClientRect().right)/2,n=i/2,r=1==this.dog_number?"dog":"dog2",o=this.draw_orientation?this.kioapi.getResource(r):null;if(0!=this.tesselationSelect.length){this.tesselationSelect.value||(this.tesselationSelect.value="0");var s=+this.tesselationSelect.value,a=this.tessellations[s];new V(o,a,e,n,t,i,10).draw(this.tessellation_ctx,tt,$);var h=a.pieces[0],p=a.indexes;console.log("selecting tessellation "+a.piece_type.name+" "+a.grid_type);for(var u=0,l=p;u<l.length;u++){var f=l[u];console.log(h.point(f).toString())}}else{var v=this.tessellation_ctx;v.clearRect(0,0,t,i),v.fillStyle=v.createPattern(this.kioapi.getResource("wave"),"repeat"),v.fillRect(0,0,t,i);var d=this.editor.piece;if(this.has_error||!d)return;var y=new c(it,it,[d],w,[]);new V(o,y,e,n,t,i,10).draw(v,tt,$)}},t.prototype.solution=function(){for(var t=[],i=0,e=this.editor.points;i<e.length;i++){var n=e[i];t.push(n.x,n.y)}return{p:t}},t.prototype.updateTessellationPiece=function(t){var i=this,e=function(){i.has_error=!0;var e=null==t?0:t.size_without_inner_points;i.kioapi.submitResult({ok:0,g:0,v:e,s:0}),i.updateTessellationView();var n=document.createElement("optgroup");n.label="не фигура",i.tesselationSelect.add(n)};if(this.has_error=!1,this.tessellations=[],this.tesselationSelect.innerHTML="",null!=t)if(0!=(t=t.fulfill()).sign){var n=[];t.searchForType((function(e,r){var o=e.tessellate(t,r);if(null!=o){for(var s,a,h,p=!1,u=0,l=n;u<l.length;u++){var c=(y=l[u])[0],f=c.grid_type==o.grid_type;if(g(s=o,a=c,h=i.need_take_care_of_orientation)&&g(a,s,h)&&f){if(p=!0,y.length>20)break;for(var v=0,d=y;v<d.length;v++)if(b(d[v],o,i.need_take_care_of_orientation))return;y.push(o)}}if(!p){var y=[o];n.push(y)}}}));for(var r=0,o=0,s=n;o<s.length;o++){var a=s[o];if(r++,a.length>1){(v=document.createElement("optgroup")).label=r+" (похожие)";for(var h=0,p=0,u=a;p<u.length;p++){var l=u[p];h++;var c=-1+this.tessellations.push(l);(f=document.createElement("option")).value=""+c,f.innerText=r+"-"+h,v.append(f),this.tesselationSelect.add(v)}}else{var f;l=a[0],c=-1+this.tessellations.push(l),(f=document.createElement("option")).value=""+c,f.innerText=""+r,f.classList.add("top"),this.tesselationSelect.add(f)}}this.updateTessellationView(),this.update_symmetries(t);var v,d=n.length;this.kioapi.submitResult({ok:d>0,g:d,v:t.size_without_inner_points,s:this.has_symmetries?1:0}),0==d&&((v=document.createElement("optgroup")).label="нет узоров",this.tesselationSelect.add(v))}else e();else e()},t.prototype.update_symmetries=function(t){var i=t.find_symmetry();console.log("symmetries",i),this.has_symmetries=i.length>0;for(var e=0,n=i;e<n.length;e++){var r=n[e],o=r[0],s=r.slice(1);"rot"==o?this.editor.draw_info_point(s[0]):"sym"==o&&this.editor.draw_info_line(s[0],s[1])}this.editor.redraw()},t}();function nt(t,i){var e;return void 0===i&&(i=100),function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=this;clearTimeout(e),e=setTimeout((function(){return t.apply(o,n)}),i)}}}},i={};function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{}};return t[n](r,r.exports,e),r.exports}return e.d=(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},e.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e(2563)})();